# ESP32配网助手

这是一个用于帮助ESP32设备连接WiFi的微信小程序。通过AP配网模式，实现小程序扫描并连接ESP32设备热点，然后发送家庭WiFi信息给ESP32设备，使其能够连接到互联网。

## 功能特点

- 获取当前连接的WiFi信息
- 扫描并连接ESP32设备AP热点（SSID格式为"xiaozhi-xxxx"）
- 向ESP32发送WiFi配置信息
- 检查ESP32配网状态
- 用户友好的界面和操作流程

## 项目结构

```
├── app.js                 # 小程序入口文件
├── app.json               # 小程序配置文件
├── app.wxss               # 小程序全局样式
├── assets/                # 静态资源
├── components/            # 公共组件（如需）
├── pages/                 # 页面文件
│   ├── index/             # 首页
│   ├── device-list/       # 设备列表页
│   └── wifi-config/       # WiFi配置页
├── services/              # 服务层
│   └── esp-service.js     # ESP设备通信服务
└── utils/                 # 工具函数
    ├── util.js            # 通用工具函数
    └── wifi.js            # WiFi相关工具函数
```

## 小程序部署指南

### 开发环境准备

1. 下载并安装[微信开发者工具](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)
2. 注册[微信小程序账号](https://mp.weixin.qq.com/)并获取AppID
3. 在微信公众平台配置开发者信息并设置合法域名

### 项目导入与配置

1. 打开微信开发者工具，选择"导入项目"
2. 选择项目所在目录，填入AppID
3. 在项目的app.json中，确保已配置所需权限：
   ```json
   "permission": {
     "scope.userLocation": {
       "desc": "获取位置信息用于搜索附近WiFi"
     }
   }
   ```
4. 创建`assets`目录并添加logo图片

### 预览与发布

1. 点击微信开发者工具中的"预览"按钮，可使用手机扫码进行预览测试
2. 功能测试无误后，点击"上传"按钮提交代码
3. 登录微信公众平台，选择版本进行审核
4. 审核通过后发布小程序

## 用户操作指南

### 首次使用流程

1. 打开微信，搜索并进入"ESP32配网助手"小程序
2. 授权位置信息权限（用于扫描WiFi）
3. 确认当前手机已连接到家庭WiFi
4. 点击"扫描设备"按钮进入设备列表页面
5. 小程序将扫描周围的ESP32设备（SSID前缀为"xiaozhi-"）
6. 选择要配置的设备并点击"连接设备"
7. 手机将自动连接到ESP32设备的热点
8. 在WiFi配置页面，输入家庭WiFi密码
9. 点击"发送配置"将WiFi信息发送给ESP32
10. 等待配置结果反馈，成功后ESP32将连接到指定WiFi

### 注意事项

- 确保ESP32设备已开机并处于AP模式
- 配网过程中手机会暂时断开家庭WiFi，这是正常现象
- 发送配置后需要等待数秒钟ESP32连接WiFi
- 配置完成后，需手动将手机重新连接到家庭WiFi

## 配网流程

1. 用户连接到家庭WiFi
2. 打开小程序，点击"扫描设备"按钮
3. 小程序扫描并显示符合命名规则的ESP32设备热点
4. 用户选择设备并点击"连接设备"
5. 小程序自动连接ESP32设备热点
6. 跳转到WiFi配置页面，自动填入之前获取的家庭WiFi名称
7. 用户输入WiFi密码，点击"发送配置"
8. 小程序向ESP32发送配置
9. ESP32收到配置后连接到指定WiFi
10. 小程序反馈配网结果

## ESP32端程序要求

ESP32设备需要满足以下要求：

1. 设置AP热点名称格式为"xiaozhi-xxxx"，其中xxxx可以是设备ID或其他标识
2. 默认IP地址为192.168.4.1，端口号为80
3. 提供以下HTTP API接口：
   - `/ping`: GET请求，用于检查连接
   - `/status`: GET请求，返回ESP32当前状态
   - `/config`: POST请求，接收WiFi配置信息
   - `/restart`: POST请求，重启ESP32设备

### ESP32端HTTP接口规范

#### 1. `/ping`
- 方法: GET
- 响应: 200 OK

#### 2. `/status`
- 方法: GET
- 响应: 
  ```json
  {
    "connected": true/false,
    "ssid": "连接的WiFi名称",
    "ip": "ESP32的IP地址",
    "rssi": "信号强度",
    "mac": "ESP32的MAC地址"
  }
  ```

#### 3. `/config`
- 方法: POST
- 请求体:
  ```json
  {
    "ssid": "WiFi名称",
    "password": "WiFi密码"
  }
  ```
- 响应:
  ```json
  {
    "success": true/false,
    "message": "处理结果描述"
  }
  ```

#### 4. `/restart`
- 方法: POST
- 响应:
  ```json
  {
    "success": true
  }
  ```

## 功能扩展建议

当前接口已实现基本配网功能，但还可考虑以下扩展：

### 设备端扩展
1. **设备管理API**
   - `/device/info`: 获取设备型号、固件版本等信息
   - `/device/update`: 支持OTA固件更新
   - `/device/settings`: 设备参数配置

2. **安全增强**
   - 实现基于Token的接口认证机制
   - 支持HTTPS加密通信
   - 添加WiFi信息传输加密

3. **更多WiFi选项**
   - 支持隐藏SSID连接
   - 支持WPA企业级加密
   - 添加静态IP配置选项

### 小程序端扩展
1. **多设备管理**
   - 保存已配置设备列表
   - 批量配置多个设备
   - 设备分组管理

2. **用户功能**
   - 用户注册登录
   - 绑定设备到用户账号
   - 远程查看设备状态

3. **体验优化**
   - 添加引导教程
   - 配网成功率统计
   - 常见问题自动排查

4. **云端集成**
   - 接入物联网云平台
   - 数据存储与分析
   - 设备远程控制

5. **多平台支持**
   - 发布H5网页版配网工具
   - 开发Android/iOS原生应用


## 安全考虑

1. 在实际部署时，ESP32设备的AP热点应添加密码保护
2. 小程序与ESP32的通信应使用HTTPS和加密方式
3. WiFi密码应使用加密算法在传输过程中保护
4. ESP32保存的WiFi信息应加密存储

## 使用提示

1. 确保手机允许小程序使用WiFi和位置权限
2. ESP32设备应处于配网模式（AP模式）
3. 配网过程中，手机将临时断开家庭WiFi而连接ESP32设备热点
4. 配网完成后，需手动重新连接家庭WiFi

## 疑难解答

1. **扫描不到设备**
   - 确认ESP32已上电并处于AP模式（LED快闪）
   - 确认设备AP名称以"xiaozhi-"开头
   - 尝试靠近ESP32设备

2. **连接设备失败**
   - 检查ESP32是否仍在工作
   - 尝试手动连接ESP32热点后再操作
   - 重启ESP32设备

3. **发送配置失败**
   - 确认已连接到ESP32热点
   - 检查ESP32 IP地址是否为192.168.4.1
   - 查看ESP32串口输出调试信息

4. **ESP32无法连接WiFi**
   - 确认输入的WiFi密码正确
   - 检查家庭WiFi是否为2.4GHz频段（ESP32不支持5GHz）
   - 确认家庭WiFi路由器工作正常

## 项目维护

本项目遵循模块化设计原则，采用高内聚、低耦合的架构，便于维护和扩展：

1. 业务逻辑和UI分离
2. WiFi操作封装在utils/wifi.js模块
3. ESP设备通信独立到services/esp-service.js
4. 通用工具函数在utils/util.js

## 开发者

- 作者：[你的名字]
- 邮箱：[你的邮箱]
- 版本：1.0.0 